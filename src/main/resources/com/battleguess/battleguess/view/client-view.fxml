<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.geometry.Insets?>
<?import javafx.scene.control.Button?>
<?import javafx.scene.control.Label?>
<?import javafx.scene.control.ListView?>
<?import javafx.scene.control.TextField?>
<?import javafx.scene.layout.BorderPane?>
<?import javafx.scene.layout.HBox?>
<?import javafx.scene.layout.VBox?>
<?import java.net.URL?>
<?import javafx.scene.control.Tab?>
<?import javafx.scene.control.TabPane?>
<?import javafx.scene.layout.Region?>
<?import javafx.scene.control.Separator?>
<?import javafx.scene.layout.StackPane?>
<?import javafx.scene.shape.Circle?>
<?import javafx.scene.layout.FlowPane?>
<?import javafx.scene.control.ScrollPane?>

<BorderPane fx:id="rootLayout" xmlns:fx="http://javafx.com/fxml"
            fx:controller="com.battleguess.battleguess.controller.ClientController"
            prefHeight="700.0" prefWidth="900.0">
    <stylesheets>
        <URL value="@../css/modern.css"/>
    </stylesheets>

    <left>
        <VBox fx:id="leftNavPane" spacing="20" styleClass="card"
              visible="false" managed="false" prefWidth="350">
            <padding>
                <Insets top="20" right="20" bottom="20" left="20"/>
            </padding>
            <VBox spacing="5" style="-fx-alignment: CENTER_LEFT; -fx-background-color: rgba(0,0,0,0.2); -fx-padding: 10; -fx-background-radius: 5;">
                <Label text="ðŸ‘¤ Há»“ sÆ¡ cá»§a báº¡n" styleClass="title-label" style="-fx-font-size: 14px;"/>
                <Label fx:id="lblPlayerName" text="TÃªn: ..." style="-fx-font-size: 16px; -fx-text-fill: #ecf0f1; -fx-font-weight: bold;"/>
                <Label fx:id="lblPlayerID" text="ID: ..." style="-fx-font-size: 13px; -fx-text-fill: #bdc3c7;"/>
                <Label fx:id="lblPlayerScore" text="Äiá»ƒm: 0" style="-fx-font-size: 14px; -fx-text-fill: #f1c40f; -fx-font-weight: bold;"/>
            </VBox>

            <TabPane VBox.vgrow="ALWAYS" tabClosingPolicy="UNAVAILABLE">
                <tabs>
                    <Tab text="PhÃ²ng Ä‘Ã£ táº¡o">
                        <VBox spacing="10" style="-fx-padding: 10 0 0 0;">
                            <Button fx:id="btnShowCreateRoom" text="+ Táº¡o phÃ²ng má»›i"
                                    onAction="#handleShowCreateRoom" styleClass="primary-button" maxWidth="Infinity"/>
                            <ListView fx:id="createdRoomsListView" VBox.vgrow="ALWAYS"/>
                        </VBox>
                    </Tab>
                    <Tab text="PhÃ²ng Ä‘Ã£ tham gia">
                        <VBox spacing="10" style="-fx-padding: 10 0 0 0;">
                            <HBox alignment="CENTER_RIGHT" style="-fx-padding: 0 5 5 0;">
                                <Button fx:id="reloadJoinedRoomsButton" text="ðŸ”„ Táº£i láº¡i"
                                        styleClass="tool-button" style="-fx-font-size: 10px;"/>
                            </HBox>
                            <ListView fx:id="joinedRoomsListView" VBox.vgrow="ALWAYS"/>
                        </VBox>
                    </Tab>
                </tabs>
            </TabPane>

            <Button fx:id="btnLogout" text="ÄÄƒng xuáº¥t" styleClass="danger" maxWidth="Infinity" onAction="#handleLogout"/>
        </VBox>
    </left>

    <center>
        <VBox fx:id="mainPane" alignment="CENTER" spacing="20">
            <padding>
                <Insets top="30" bottom="30" left="40" right="40"/>
            </padding>

            <VBox fx:id="gamePane" spacing="15" alignment="TOP_CENTER"
                  visible="true" managed="true" styleClass="card" prefWidth="400">
                <Label text="--- TÃŒM PHÃ’NG ---" styleClass="form-label"/>
                <HBox spacing="10" alignment="CENTER">
                    <TextField fx:id="joinByCodeField" promptText="Nháº­p Room Code..." styleClass="form-field" HBox.hgrow="ALWAYS"/>
                    <Button fx:id="joinByCodeButton" text="Join" styleClass="secondary-button"/>
                </HBox>
            </VBox>

            <BorderPane fx:id="inRoomPane" visible="false" managed="false" styleClass="card"
                        prefHeight="600" prefWidth="800">

                <top>
                    <HBox alignment="CENTER_LEFT" spacing="10" styleClass="toolbar">
                        <padding><Insets top="10" right="10" bottom="10" left="10"/></padding>
                        <Label fx:id="lblRoomName" text="TÃªn phÃ²ng" styleClass="title-label"/>
                        <Label fx:id="lblRoomCode" text="(Code: ???)" style="-fx-text-fill: #ccc;"/>
                        <Region HBox.hgrow="ALWAYS"/>
                        <Button fx:id="btnCloseRoom" text="ÄÃ³ng phÃ²ng" styleClass="danger" onAction="#handleCloseRoom"/>
                        <Button fx:id="btnExitRoom" text="ThoÃ¡t (Vá» sáº£nh)" onAction="#handleExitRoom"/>
                    </HBox>
                </top>

                <right>
                    <VBox spacing="10" style="-fx-padding: 10;" prefWidth="320">

                        <VBox spacing="2" style="-fx-background-color: rgba(255,255,255,0.1); -fx-padding: 8; -fx-background-radius: 5;">
                            <Label text="ThÃ´ng tin cá»§a báº¡n:" style="-fx-font-size: 11px; -fx-text-fill: #aaa;"/>
                            <HBox spacing="10" alignment="CENTER_LEFT">
                                <Label fx:id="lblInRoomName" text="TÃªn" style="-fx-font-weight: bold; -fx-text-fill: white;"/>
                                <Label fx:id="lblInRoomID" text="(ID: ...)" style="-fx-text-fill: #ccc; -fx-font-size: 11px;"/>
                                <Region HBox.hgrow="ALWAYS"/>
                                <Label fx:id="lblInRoomScore" text="0 pts" style="-fx-text-fill: #f1c40f; -fx-font-weight: bold;"/>
                            </HBox>
                        </VBox>

                        <HBox alignment="CENTER_LEFT" spacing="10">
                            <Label text="NgÆ°á»i chÆ¡i" styleClass="title-label"/>
                            <Region HBox.hgrow="ALWAYS"/>
                            <Button fx:id="reloadPlayerListButton" text="ðŸ”„" styleClass="tool-button"/>
                        </HBox>
                        <VBox VBox.vgrow="NEVER" prefHeight="200">
                            <ListView fx:id="playerListView" />
                        </VBox>

                        <Separator/>

                        <HBox fx:id="iconBarContainer" alignment="CENTER_LEFT" spacing="5" styleClass="toolbar" style="-fx-background-radius: 10;">
                            <padding><Insets top="5" right="10" bottom="5" left="10"/></padding>
                            <StackPane fx:id="chatIconBar">
                                <Button fx:id="chatToggleButton" text="ðŸ’¬" styleClass="tool-button"/>
                                <Circle fx:id="chatNotificationDot" radius="6" styleClass="notification-dot"
                                        visible="false" managed="false" translateX="15" translateY="-10"/>
                            </StackPane>
                            <StackPane fx:id="videoIconBar">
                                <Button fx:id="videoToggleButton" text="ðŸ“·" styleClass="tool-button"/>
                                <Circle fx:id="videoNotificationDot" radius="6" styleClass="notification-dot"
                                        visible="false" managed="false" translateX="15" translateY="-10"/>
                            </StackPane>

                            <StackPane fx:id="micIconBar">
                                <Button fx:id="micToggleButton" text="ðŸŽ™" styleClass="tool-button"/>
                                <Circle fx:id="micNotificationDot" radius="6" styleClass="notification-dot"
                                        visible="false" managed="false" translateX="15" translateY="-10"/>
                            </StackPane>
                        </HBox>

                        <VBox fx:id="chatWindowContainer" spacing="10" visible="false" managed="false" VBox.vgrow="ALWAYS">
                            <HBox alignment="CENTER_LEFT" spacing="10">
                                <Label text="TrÃ² chuyá»‡n" styleClass="title-label"/>
                                <Region HBox.hgrow="ALWAYS"/>
                                <Button fx:id="closeChatButton" text="âŒ" styleClass="tool-button" style="-fx-background-color: transparent;"/>
                            </HBox>
                            <ScrollPane fx:id="emojiScrollPane" VBox.vgrow="NEVER"
                                        visible="false" managed="false" prefHeight="100"
                                        fitToWidth="true" style="-fx-background-color: #2c3e50;">
                                <FlowPane fx:id="emojiFlowPane" hgap="5" vgap="5" style="-fx-padding: 5;"/>
                            </ScrollPane>
                            <ListView fx:id="chatMessagesListView" VBox.vgrow="ALWAYS" style="-fx-background-color: #3e4a5a;"/>
                            <HBox spacing="5">
                                <TextField fx:id="chatInputField" promptText="Nháº­p tin nháº¯n..." HBox.hgrow="ALWAYS" styleClass="form-field"/>
                                <Button fx:id="emojiButton" text="ðŸ˜€" styleClass="tool-button" onAction="#handleEmojiButtonToggle"/>
                                <Button fx:id="sendChatButton" text="Gá»­i" styleClass="primary-button"/>
                            </HBox>
                        </VBox>

                    </VBox>
                </right>

                <center>
                    <StackPane fx:id="centerStackPane">

                        <BorderPane fx:id="canvasAndGuessArea">
                            <center>
                                <BorderPane fx:id="canvasHostPane" />
                            </center>
                            <bottom>
                                <HBox spacing="10" alignment="CENTER" style="-fx-padding: 10;">
                                    <TextField fx:id="puzzleAnswerField" promptText="Nháº­p Ä‘Ã¡p Ã¡n..." styleClass="form-field" HBox.hgrow="ALWAYS"/>
                                    <Button fx:id="sendPuzzleButton" text="Gá»­i cÃ¢u Ä‘á»‘" styleClass="primary-button"
                                            onAction="#handleSendPuzzle"
                                            visible="false" managed="false"/>
                                    <Button fx:id="sendGuessButton" text="Gá»­i dá»± Ä‘oÃ¡n" styleClass="primary-button"
                                            onAction="#handleSendGuess"
                                            visible="false" managed="false"/>
                                </HBox>
                            </bottom>
                        </BorderPane>

                        <VBox fx:id="videoWindowContainer" spacing="10" visible="false" managed="false" VBox.vgrow="ALWAYS"
                              style="-fx-background-color: #2c3e50; -fx-padding: 10;">

                            <HBox alignment="CENTER_LEFT" spacing="10">
                                <Label text="Camera" styleClass="title-label"/>
                                <Region HBox.hgrow="ALWAYS"/>
                                <Button fx:id="closeVideoButton" text="ÄÃ³ng Video âž”" styleClass="tool-button" style="-fx-background-color: transparent;"/>
                            </HBox>

                            <ScrollPane VBox.vgrow="ALWAYS" fitToWidth="true" style="-fx-background-color: #3e4a5a;">
                                <FlowPane fx:id="videoGridPane" hgap="10" vgap="10" style="-fx-padding: 10; -fx-background-color: #3e4a5a;"/>
                            </ScrollPane>

                            <HBox alignment="CENTER" style="-fx-padding: 5;" spacing="10">
                                <Button fx:id="toggleSelfMicButton" text="Báº­t Mic" styleClass="primary-button"/>
                                <Button fx:id="toggleSelfCameraButton" text="Báº­t Camera" styleClass="primary-button"/>
                            </HBox>
                        </VBox>

                    </StackPane>
                </center>
            </BorderPane>
        </VBox>
    </center>
</BorderPane>